(()=>{"use strict";var e={37:e=>{e.exports=require("mongoose")},60:(e,o)=>{Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const t=Symbol("dangerouslyDisableDefaultSrc"),r=new Set(["none","self","strict-dynamic","report-sample","inline-speculation-rules","unsafe-inline","unsafe-eval","unsafe-hashes","wasm-unsafe-eval"]),n=()=>({"default-src":["'self'"],"base-uri":["'self'"],"font-src":["'self'","https:","data:"],"form-action":["'self'"],"frame-ancestors":["'self'"],"img-src":["'self'","data:"],"object-src":["'none'"],"script-src":["'self'"],"script-src-attr":["'none'"],"style-src":["'self'","https:","'unsafe-inline'"],"upgrade-insecure-requests":[]}),i=(e,o)=>{if(/;|,/.test(o))throw new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(e)}`)},s=(e,o)=>{if(r.has(o)||o.startsWith("nonce-")||o.startsWith("sha256-")||o.startsWith("sha384-")||o.startsWith("sha512-"))throw new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(e)}. ${JSON.stringify(o)} should be quoted`)};const c=function(e={}){const o=e.reportOnly?"Content-Security-Policy-Report-Only":"Content-Security-Policy",r=function(e){const o={"default-src":["'self'"],"base-uri":["'self'"],"font-src":["'self'","https:","data:"],"form-action":["'self'"],"frame-ancestors":["'self'"],"img-src":["'self'","data:"],"object-src":["'none'"],"script-src":["'self'"],"script-src-attr":["'none'"],"style-src":["'self'","https:","'unsafe-inline'"],"upgrade-insecure-requests":[]},{useDefaults:r=!0,directives:n=o}=e,c=new Map,a=new Set,l=new Set;for(const e in n){if(!Object.hasOwn(n,e))continue;if(0===e.length||/[^a-zA-Z0-9-]/.test(e))throw new Error(`Content-Security-Policy received an invalid directive name ${JSON.stringify(e)}`);const o=e.replace(/[A-Z]/g,(e=>"-"+e.toLowerCase()));if(a.has(o))throw new Error(`Content-Security-Policy received a duplicate directive ${JSON.stringify(o)}`);a.add(o);const r=n[e];let u;if(null!==r){if("string"==typeof r)u=[r];else{if(!r)throw new Error(`Content-Security-Policy received an invalid directive value for ${JSON.stringify(o)}`);if(r===t){if("default-src"===o){l.add("default-src");continue}throw new Error(`Content-Security-Policy: tried to disable ${JSON.stringify(o)} as if it were default-src; simply omit the key`)}u=r}for(const e of u)"string"==typeof e&&(i(o,e),s(o,e));c.set(o,u)}else{if("default-src"===o)throw new Error("Content-Security-Policy needs a default-src but it was set to `null`. If you really want to disable it, set it to `contentSecurityPolicy.dangerouslyDisableDefaultSrc`.");l.add(o)}}if(r&&Object.entries(o).forEach((([e,o])=>{c.has(e)||l.has(e)||c.set(e,o)})),!c.size)throw new Error("Content-Security-Policy has no directives. Either set some or disable the header");if(!c.has("default-src")&&!l.has("default-src"))throw new Error("Content-Security-Policy needs a default-src but none was provided. If you really want to disable it, set it to `contentSecurityPolicy.dangerouslyDisableDefaultSrc`.");return c}(e);return function(e,t,n){const c=function(e,o,t){const r=[];for(const[n,c]of t){let t="";for(const r of c)if("function"==typeof r){const i=r(e,o);s(n,i),t+=" "+i}else t+=" "+r;t?(i(n,t),r.push(`${n}${t}`)):r.push(n)}return r.join(";")}(e,t,r);c instanceof Error?n(c):(t.setHeader(o,c),n())}};c.getDefaultDirectives=n,c.dangerouslyDisableDefaultSrc=t;const a=new Set(["require-corp","credentialless","unsafe-none"]);function l(e={}){const o=function({policy:e="require-corp"}){if(a.has(e))return e;throw new Error(`Cross-Origin-Embedder-Policy does not support the ${JSON.stringify(e)} policy`)}(e);return function(e,t,r){t.setHeader("Cross-Origin-Embedder-Policy",o),r()}}const u=new Set(["same-origin","same-origin-allow-popups","unsafe-none"]);function d(e={}){const o=function({policy:e="same-origin"}){if(u.has(e))return e;throw new Error(`Cross-Origin-Opener-Policy does not support the ${JSON.stringify(e)} policy`)}(e);return function(e,t,r){t.setHeader("Cross-Origin-Opener-Policy",o),r()}}const f=new Set(["same-origin","same-site","cross-origin"]);function p(e={}){const o=function({policy:e="same-origin"}){if(f.has(e))return e;throw new Error(`Cross-Origin-Resource-Policy does not support the ${JSON.stringify(e)} policy`)}(e);return function(e,t,r){t.setHeader("Cross-Origin-Resource-Policy",o),r()}}function h(){return function(e,o,t){o.setHeader("Origin-Agent-Cluster","?1"),t()}}const w=new Set(["no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url",""]);function g(e={}){const o=function({policy:e=["no-referrer"]}){const o="string"==typeof e?[e]:e;if(0===o.length)throw new Error("Referrer-Policy received no policy tokens");const t=new Set;return o.forEach((e=>{if(!w.has(e))throw new Error(`Referrer-Policy received an unexpected policy token ${JSON.stringify(e)}`);if(t.has(e))throw new Error(`Referrer-Policy received a duplicate policy token ${JSON.stringify(e)}`);t.add(e)})),o.join(",")}(e);return function(e,t,r){t.setHeader("Referrer-Policy",o),r()}}function y(e=31536e3){if(e>=0&&Number.isFinite(e))return Math.floor(e);throw new Error(`Strict-Transport-Security: ${JSON.stringify(e)} is not a valid value for maxAge. Please choose a positive integer.`)}function m(e={}){const o=function(e){if("maxage"in e)throw new Error("Strict-Transport-Security received an unsupported property, `maxage`. Did you mean to pass `maxAge`?");if("includeSubdomains"in e)throw new Error('Strict-Transport-Security middleware should use `includeSubDomains` instead of `includeSubdomains`. (The correct one has an uppercase "D".)');const o=[`max-age=${y(e.maxAge)}`];return(void 0===e.includeSubDomains||e.includeSubDomains)&&o.push("includeSubDomains"),e.preload&&o.push("preload"),o.join("; ")}(e);return function(e,t,r){t.setHeader("Strict-Transport-Security",o),r()}}function P(){return function(e,o,t){o.setHeader("X-Content-Type-Options","nosniff"),t()}}function S(e={}){const o=e.allow?"on":"off";return function(e,t,r){t.setHeader("X-DNS-Prefetch-Control",o),r()}}function v(){return function(e,o,t){o.setHeader("X-Download-Options","noopen"),t()}}function O(e={}){const o=function({action:e="sameorigin"}){const o="string"==typeof e?e.toUpperCase():e;switch(o){case"SAME-ORIGIN":return"SAMEORIGIN";case"DENY":case"SAMEORIGIN":return o;default:throw new Error(`X-Frame-Options received an invalid action ${JSON.stringify(e)}`)}}(e);return function(e,t,r){t.setHeader("X-Frame-Options",o),r()}}const b=new Set(["none","master-only","by-content-type","all"]);function D(e={}){const o=function({permittedPolicies:e="none"}){if(b.has(e))return e;throw new Error(`X-Permitted-Cross-Domain-Policies does not support ${JSON.stringify(e)}`)}(e);return function(e,t,r){t.setHeader("X-Permitted-Cross-Domain-Policies",o),r()}}function C(){return function(e,o,t){o.removeHeader("X-Powered-By"),t()}}function x(){return function(e,o,t){o.setHeader("X-XSS-Protection","0"),t()}}const E=Object.assign((function(e={}){if("IncomingMessage"===e.constructor?.name)throw new Error("It appears you have done something like `app.use(helmet)`, but it should be `app.use(helmet())`.");const o=function(e){const o=[];switch(e.contentSecurityPolicy){case void 0:case!0:o.push(c());break;case!1:break;default:o.push(c(e.contentSecurityPolicy))}switch(e.crossOriginEmbedderPolicy){case void 0:case!1:break;case!0:o.push(l());break;default:o.push(l(e.crossOriginEmbedderPolicy))}switch(e.crossOriginOpenerPolicy){case void 0:case!0:o.push(d());break;case!1:break;default:o.push(d(e.crossOriginOpenerPolicy))}switch(e.crossOriginResourcePolicy){case void 0:case!0:o.push(p());break;case!1:break;default:o.push(p(e.crossOriginResourcePolicy))}switch(e.originAgentCluster){case void 0:case!0:o.push((function(e,o,t){o.setHeader("Origin-Agent-Cluster","?1"),t()}));break;case!1:break;default:console.warn("Origin-Agent-Cluster does not take options. Remove the property to silence this warning."),o.push((function(e,o,t){o.setHeader("Origin-Agent-Cluster","?1"),t()}))}switch(e.referrerPolicy){case void 0:case!0:o.push(g());break;case!1:break;default:o.push(g(e.referrerPolicy))}if("strictTransportSecurity"in e&&"hsts"in e)throw new Error("Strict-Transport-Security option was specified twice. Remove `hsts` to silence this warning.");const t=e.strictTransportSecurity??e.hsts;switch(t){case void 0:case!0:o.push(m());break;case!1:break;default:o.push(m(t))}if("xContentTypeOptions"in e&&"noSniff"in e)throw new Error("X-Content-Type-Options option was specified twice. Remove `noSniff` to silence this warning.");switch(e.xContentTypeOptions??e.noSniff){case void 0:case!0:o.push((function(e,o,t){o.setHeader("X-Content-Type-Options","nosniff"),t()}));break;case!1:break;default:console.warn("X-Content-Type-Options does not take options. Remove the property to silence this warning."),o.push((function(e,o,t){o.setHeader("X-Content-Type-Options","nosniff"),t()}))}if("xDnsPrefetchControl"in e&&"dnsPrefetchControl"in e)throw new Error("X-DNS-Prefetch-Control option was specified twice. Remove `dnsPrefetchControl` to silence this warning.");const r=e.xDnsPrefetchControl??e.dnsPrefetchControl;switch(r){case void 0:case!0:o.push(S());break;case!1:break;default:o.push(S(r))}if("xDownloadOptions"in e&&"ieNoOpen"in e)throw new Error("X-Download-Options option was specified twice. Remove `ieNoOpen` to silence this warning.");switch(e.xDownloadOptions??e.ieNoOpen){case void 0:case!0:o.push((function(e,o,t){o.setHeader("X-Download-Options","noopen"),t()}));break;case!1:break;default:console.warn("X-Download-Options does not take options. Remove the property to silence this warning."),o.push((function(e,o,t){o.setHeader("X-Download-Options","noopen"),t()}))}if("xFrameOptions"in e&&"frameguard"in e)throw new Error("X-Frame-Options option was specified twice. Remove `frameguard` to silence this warning.");const n=e.xFrameOptions??e.frameguard;switch(n){case void 0:case!0:o.push(O());break;case!1:break;default:o.push(O(n))}if("xPermittedCrossDomainPolicies"in e&&"permittedCrossDomainPolicies"in e)throw new Error("X-Permitted-Cross-Domain-Policies option was specified twice. Remove `permittedCrossDomainPolicies` to silence this warning.");const i=e.xPermittedCrossDomainPolicies??e.permittedCrossDomainPolicies;switch(i){case void 0:case!0:o.push(D());break;case!1:break;default:o.push(D(i))}if("xPoweredBy"in e&&"hidePoweredBy"in e)throw new Error("X-Powered-By option was specified twice. Remove `hidePoweredBy` to silence this warning.");switch(e.xPoweredBy??e.hidePoweredBy){case void 0:case!0:o.push((function(e,o,t){o.removeHeader("X-Powered-By"),t()}));break;case!1:break;default:console.warn("X-Powered-By does not take options. Remove the property to silence this warning."),o.push((function(e,o,t){o.removeHeader("X-Powered-By"),t()}))}if("xXssProtection"in e&&"xssFilter"in e)throw new Error("X-XSS-Protection option was specified twice. Remove `xssFilter` to silence this warning.");switch(e.xXssProtection??e.xssFilter){case void 0:case!0:o.push((function(e,o,t){o.setHeader("X-XSS-Protection","0"),t()}));break;case!1:break;default:console.warn("X-XSS-Protection does not take options. Remove the property to silence this warning."),o.push((function(e,o,t){o.setHeader("X-XSS-Protection","0"),t()}))}return o}(e);return function(e,t,r){let n=0;!function i(s){if(s)return void r(s);const c=o[n];c?(n++,c(e,t,i)):r()}()}}),{contentSecurityPolicy:c,crossOriginEmbedderPolicy:l,crossOriginOpenerPolicy:d,crossOriginResourcePolicy:p,originAgentCluster:h,referrerPolicy:g,strictTransportSecurity:m,xContentTypeOptions:P,xDnsPrefetchControl:S,xDownloadOptions:v,xFrameOptions:O,xPermittedCrossDomainPolicies:D,xPoweredBy:C,xXssProtection:x,dnsPrefetchControl:S,xssFilter:x,permittedCrossDomainPolicies:D,ieNoOpen:v,noSniff:P,frameguard:O,hidePoweredBy:C,hsts:m});o.contentSecurityPolicy=c,o.crossOriginEmbedderPolicy=l,o.crossOriginOpenerPolicy=d,o.crossOriginResourcePolicy=p,o.default=E,o.dnsPrefetchControl=S,o.frameguard=O,o.hidePoweredBy=C,o.hsts=m,o.ieNoOpen=v,o.noSniff=P,o.originAgentCluster=h,o.permittedCrossDomainPolicies=D,o.referrerPolicy=g,o.strictTransportSecurity=m,o.xContentTypeOptions=P,o.xDnsPrefetchControl=S,o.xDownloadOptions=v,o.xFrameOptions=O,o.xPermittedCrossDomainPolicies=D,o.xPoweredBy=C,o.xXssProtection=x,o.xssFilter=x,e.exports=o.default,e.exports.default=e.exports},71:function(e,o,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0}),o.connectToDatabase=void 0;const n=r(t(37)),i=t(187);o.connectToDatabase=async()=>{try{const e=process.env.MONGODB_URI||"mongodb://localhost:27017/flash_loans_bot";await n.default.connect(e),i.logger.info("Successfully connected to MongoDB"),n.default.connection.on("error",(e=>{i.logger.error("MongoDB connection error:",e)})),n.default.connection.on("disconnected",(()=>{i.logger.warn("MongoDB disconnected")})),process.on("SIGINT",(async()=>{await n.default.connection.close(),i.logger.info("MongoDB connection closed due to application termination"),process.exit(0)}))}catch(e){throw i.logger.error("Failed to connect to MongoDB:",e),e instanceof Error?new Error(`Failed to connect to MongoDB: ${e.message}`):new Error("Failed to connect to MongoDB due to an unknown error.")}}},124:e=>{e.exports=require("winston")},187:function(e,o,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0}),o.logger=void 0;const n=r(t(124));n.default.addColors({error:"red",warn:"yellow",info:"green",http:"magenta",debug:"blue"});const i=n.default.format.combine(n.default.format.timestamp({format:"YYYY-MM-DD HH:mm:ss:ms"}),n.default.format.colorize({all:!0}),n.default.format.printf((e=>`${e.timestamp} ${e.level}: ${e.message}`))),s=[new n.default.transports.Console,new n.default.transports.File({filename:"logs/error.log",level:"error"}),new n.default.transports.File({filename:"logs/all.log"})];o.logger=n.default.createLogger({level:"info",levels:{error:0,warn:1,info:2,http:3,debug:4},format:i,transports:s})},229:function(e,o,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0});const n=r(t(818)),i=r(t(252)),s=r(t(577)),c=r(t(60)),a=t(611),l=t(187),u=t(71),d=t(663);n.default.config();const f=(0,i.default)(),p=process.env.PORT||3e3,h=process.env.HOST||"0.0.0.0";f.use((0,c.default)()),f.use((0,s.default)()),f.use(i.default.json()),f.get("/health",((e,o)=>{o.status(200).json({status:"ok",timestamp:(new Date).toISOString()})}));const w=(0,a.createServer)(f);process.on("SIGTERM",(()=>{l.logger.info("SIGTERM received, shutting down gracefully"),w.close((()=>{l.logger.info("Server closed"),process.exit(0)}))})),async function(){try{await(0,u.connectToDatabase)(),await(0,d.connectToRedis)(),w.listen(p,(()=>{l.logger.info(`Server running at http://${h}:${p}`)}))}catch(e){l.logger.error("Failed to start server:",e),process.exit(1)}}(),o.default=w},252:e=>{e.exports=require("express")},577:e=>{e.exports=require("cors")},611:e=>{e.exports=require("http")},659:e=>{e.exports=require("ioredis")},663:function(e,o,t){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(o,"__esModule",{value:!0}),o.getRedisClient=o.connectToRedis=void 0;const n=r(t(659)),i=t(187);let s;o.connectToRedis=async()=>{try{const e=process.env.REDIS_HOST||"localhost",o=parseInt(process.env.REDIS_PORT||"6379",10),t=process.env.REDIS_PASSWORD||void 0;s=new n.default({host:e,port:o,password:t,retryStrategy:e=>{const o=Math.min(50*e,2e3);return i.logger.info(`Redis connection retry attempt ${e}, delaying for ${o}ms`),o},maxRetriesPerRequest:null}),await s.ping(),i.logger.info("Successfully connected to Redis"),s.on("error",(e=>{i.logger.error("Redis connection error:",e)})),s.on("close",(()=>{i.logger.warn("Redis connection closed")})),process.on("SIGINT",(()=>{s.quit(),i.logger.info("Redis connection closed due to application termination")}))}catch(e){throw i.logger.error("Failed to connect to Redis:",e),e instanceof Error?new Error(`Failed to connect to Redis: ${e.message}`):new Error("Failed to connect to Redis due to an unknown error.")}};o.getRedisClient=()=>{if(!s)throw new Error("Redis client not initialized. Call connectToRedis first.");return s}},818:e=>{e.exports=require("dotenv")}},o={};var t=function t(r){var n=o[r];if(void 0!==n)return n.exports;var i=o[r]={exports:{}};return e[r].call(i.exports,i,i.exports,t),i.exports}(229);module.exports=t})();
//# sourceMappingURL=bundle.js.map